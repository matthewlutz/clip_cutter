# Football Video Analyzer - Development Notes

## Project Overview
Gradio web app that analyzes football video using Gemini 2.0 Flash to find specific plays/players and extract highlight clips.

## Completed (2025-01-30)

### FFmpeg Installation
- Installed FFmpeg 8.0.1 to `C:\ffmpeg`
- Added `C:\ffmpeg\bin` to user PATH
- **Note:** New terminal windows will have ffmpeg in PATH. Current session can use `/c/ffmpeg/bin/ffmpeg` directly.

### Video Playback Fix
**Problem:** Video showed "not playable" in Gradio upload widget

**Root Cause:** The moov atom (metadata) was at the END of the 4.6GB file. Browsers need this metadata upfront to start playback - they can't stream a video when they don't know the format until the end.

**Solution:** Remuxed with `-movflags +faststart` to move moov atom to the beginning:
```bash
ffmpeg -i "input.mp4" -c copy -movflags +faststart "output_web.mp4"
```

**Test Files:**
- Original: `test_videos/Chris Brazzell II vs Georgia 2025 All 22.mp4` (moov at end, won't play in browser)
- Fixed: `test_videos/Chris Brazzell II vs Georgia 2025 All 22_web.mp4` (moov at start, browser-playable)

## Video Specs
- Codec: H.264 (Constrained Baseline)
- Resolution: 1920x1080 @ 29.97fps
- Duration: 25:38
- Bitrate: ~24 Mbps

## Architecture
- `app.py` - Gradio web UI
- `analyzer.py` - Gemini 2.0 Flash video analysis
- `clipper.py` - FFmpeg clip extraction

## Recent Changes (2025-01-30)

### UI Updates
- Added sporty PFF-style fonts (Oswald for headers, Roboto for body)
- Added "Clear Video" button to remove uploaded video
- Added "Cancel" button to stop processing
- File size check: rejects videos >2GB (Gemini's limit)

### Auto-Segmentation for Large Videos
**Problem:** 4.6GB video stalled at 10.5% during Gemini upload (Gemini has ~2GB limit)

**Solution:** Automatic video segmentation
- Videos over 1.8GB are automatically split into smaller segments
- Each segment is uploaded and analyzed separately
- Timestamps are adjusted by segment offset and combined
- Segments are ~500-600 seconds each (calculated based on file size ratio)
- Temp segments are cleaned up after processing

### Cancellation Support
- Cancel button stops processing at any point
- Cleans up uploaded files on Gemini when cancelled
- Uses threading.Event for cross-function communication

### Rate Limit Handling
- Added retry logic with exponential backoff for 429 errors
- Starts at 30s delay, doubles up to 2 min max
- 5 retry attempts before failing
- Respects cancel button during wait

## API Limits (Gemini Free Tier)
- Daily request limit exists
- If you see "RESOURCE_EXHAUSTED" errors, either:
  1. Wait for daily reset
  2. Enable billing at https://ai.google.dev/

## Next Steps
- Test with the full 4.6GB video
- Monitor segment analysis accuracy at boundaries
